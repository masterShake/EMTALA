<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<title>EMTALA_Chap8_rebuild</title>
		<link href="css/idGeneratedStyles.css" rel="stylesheet" type="text/css" />
	</head>
	<body id="EMTALA_Chap8_rebuild" lang="en-US">
		<div id="_idContainer000" class="Basic-Text-Frame">
			<p class="Master-Pages_Chapter-Head ParaOverride-1"><span class="Chapter-number"><a id="_idTextAnchor000"></a></span><span class="Chapter-number">8</span> <span class="CharOverride-1">Patient Refusal of Stabilizing Treatment or Transfer</span> </p>
		</div>
		<div id="_idContainer001" class="_idGenObjectStyleOverride-1">
			<p class="TOC_TOC-Level-1"><a href="#_idTextAnchor002">I.&#9;Overview</a></p>
			<p class="TOC_TOC-Level-2"><a href="#_idTextAnchor003">A. Refusal of Examination and Treatment</a></p>
			<p class="TOC_TOC-Level-2"><a href="#_idTextAnchor004">B. Refusal to Accept Transfer</a></p>
			<p class="TOC_TOC-Level-1"><a href="#_idTextAnchor005">II.&#9;Questions</a></p>
			<p class="TOC_TOC-Level-2"><a href="#_idTextAnchor006">A. What are the requirements to obtain an informed refusal of treatment or transfer?</a></p>
			<p class="TOC_TOC-Level-2"><a href="#_idTextAnchor007">B. What should the hospital do if a patient withdraws his or her request for examination or leaves the hospital before receiving a medical screening?</a></p>
			<p class="TOC_TOC-Level-3"><a href="#_idTextAnchor008">Patient Elopes or Leaves Without Notice</a></p>
			<p class="TOC_TOC-Level-3"><a href="#_idTextAnchor009">Patient Gives Reason for Leaving</a></p>
			<p class="TOC_TOC-Level-3"><a href="#_idTextAnchor010">Patient Departs for Financial Reasons</a></p>
			<p class="TOC_TOC-Level-3"><a href="#_idTextAnchor011">Documentation of Risks and Benefits</a></p>
			<p class="TOC_TOC-Level-2"><a href="#_idTextAnchor012">C. Is a hospital liable for a potential EMTALA violation if a patient leaves the hospital after receiving a medical screening?</a></p>
		</div>
		<div id="_idContainer002" class="Basic-Text-Frame">
			<p class="Master-Pages_Chapter-Head ParaOverride-1"><span class="Chapter-number"><a id="_idTextAnchor001"></a></span><span class="Chapter-number">8</span> <span class="CharOverride-1">Patient Refusal of Stabilizing Treatment or Transfer</span> </p>
		</div>
		<div id="_idContainer003" class="_idGenObjectStyleOverride-1">
			<ol>
				<li class="Body-Styles_Header-1"><a id="_idTextAnchor002"></a>Overview<p class="Body-Styles_Body-Text _idGenParaOverride-1"><a id="_idIndexMarker000"></a><a id="_idIndexMarker001"></a><a id="_idIndexMarker002"></a>Under EMTALA, the patient retains the right to refuse further medical examination and stabilizing treatment, as well as a transfer to another facility.</p><ol><li class="Body-Styles_Header-2 _idGenParaOverride-4"><a id="_idTextAnchor003"></a>Refusal of Examination and Treatment<p class="Body-Styles_Body-Text _idGenParaOverride-2">A hospital is deemed to meet its EMTALA obligations to provide further medical examination and stabilizing treatment to a patient if:</p><ol><li class="Body-Styles_Numbered-List _idGenParaOverride-3">The hospital offers the patient further medical examination and stabilizing treatment and informs the patient of the risks and benefits of the examination and treatment; but</li><li class="Body-Styles_Numbered-List _idGenParaOverride-3">The patient refuses to consent to the examination and treatment.</li></ol></li><li class="Body-Styles_Header-2 _idGenParaOverride-4"><a id="_idTextAnchor004"></a>Refusal to Accept Transfer</li></ol></li>
			</ol>
			<p class="Body-Styles_Body-Text">A hospital is deemed to meet its obligations to transfer the patient to another facility if:</p>
			<ol>
				<li class="Body-Styles_Numbered-List">The hospital offers to transfer the patient to another medical facility, in accordance with EMTALA requirements for a transfer, and informs the patient of the risks and benefits of the transfer; but</li>
				<li class="Body-Styles_Numbered-List">The patient refuses to consent to the transfer.</li>
			</ol>
			<ol>
				<li class="Body-Styles_Header-1"><a id="_idTextAnchor005"></a>Questions<ol><li class="Body-Styles_Header-2 _idGenParaOverride-4"><a id="_idTextAnchor006"></a>What are the requirements to obtain an informed refusal of treatment or transfer?<p class="Body-Styles_Body-Text _idGenParaOverride-2">If a patient refuses treatment or a transfer, the hospital must:</p><ol><li class="Body-Styles_Numbered-List _idGenParaOverride-3">Explain to the patient the risks and benefits of the examination and treatment or transfer; and</li><li class="Body-Styles_Numbered-List _idGenParaOverride-3">Take all reasonable steps to secure the written informed refusal of the patient (or the person acting on the patient’s behalf) to the examination and treatment or transfer.</li></ol></li></ol></li>
			</ol>
			<p class="Body-Styles_Body-Text">A hospital must take all reasonable steps to secure the informed refusal of a patient (or a person acting on the patient’s behalf). The refusal must be in writing; <a id="_idIndexMarker003"></a>document that the patient was informed of the benefits of treatment or transfer, and state the reasons for the patient’s refusal. As noted by CMS, a person acting on the patient’s behalf cannot refuse examination, treatment or a transfer unless the patient is incapable of making an informed decision for himself or herself. The patient’s medical record must contain a description of the proposed examination, treatment or transfer that was offered by the hospital but refused by the patient. If the individual refuses to sign an informed refusal, the hospital should document the steps taken to secure a signed refusal. CHA has developed CHA Form 9-6, “Patient Refusal of Further Medical Treatment,” which can be used for this purpose and is included in Appendix P.</p>
			<p class="Body-Styles_Body-Text">In addition to the EMTALA requirements, hospitals should review CHA’s <span class="Italic">Consent Manual</span> for additional guidance and documentation for situations involving refusal of medical care. CHA has developed CHA Form 5-1, “Refusal to Permit Medical Treatment,” which can be used for this purpose and is included in Appendix P.</p>
			<p class="Body-Styles_Reference-Header"><span class="Reference-mark">F</span>&#9;References:</p>
			<p class="Body-Styles_References">42 C.F.R. Section 489.24(d)(3) and (5) (Appendix B) </p>
			<p class="Body-Styles_References"><span class="Italic">Interpretive Guidelines</span> tag no. A-240<span class="No-break">7/C</span>-2407 (Appendix C)</p>
			<ol>
				<li class="Body-Styles_Header-2"><a id="_idTextAnchor007"></a>What should the hospital do if a patient withdraws his or her request for examination or leaves the hospital before receiving a medical screening?<p class="Body-Styles_Body-Text _idGenParaOverride-2">One of the most common areas of EMTALA enforcement is the patient who presents for treatment to a dedicated emergency department, but then leaves the hospital prior to receiving a medical screening examination (and sometimes, even before triage). In some cases, the patient tells a nurse or clerk that he or she feels better, and leaves the hospital. In other cases, the patient tells a nurse or clerk that he or she does not want to wait for  the medical screening examination or that he or she will go elsewhere (to a primary care physician or another facility). In other cases, the patient simply elopes and is not in the waiting room when called for his or her medical screening examination.</p><p class="Body-Styles_Body-Text _idGenParaOverride-2">In all of these cases, the patient has presented for emergency services, but has not received a medical screening examination. Without a medical examination, the patient cannot be said to be leaving against medical advice (AMA), since the hospital does not have sufficient medical information to inform the patient of the risks of leaving the hospital. However, the triage report often documents the presenting complaint, vital signs and other preliminary findings that provide regulators with information sufficient to speculate as to whether the patient had a potential emergency medical condition.</p><p class="Body-Styles_Body-Text _idGenParaOverride-2">These types of cases have been the focus of EMTALA enforcement actions. Hospitals have been cited by CMS and subject to potential OIG sanctions for failing to provide a medical screening examination to a person presenting to the emergency department for emergency services. The lack of a medical screening examination an<span class="No-break">d/o</span>r inadequate documentation of the patient’s reasons for leaving puts the hospital at a severe disadvantage when later explaining the circumstances for the patient’s departure and defending the speculation of the regulators as to the potential condition of the patient.</p><p class="Body-Styles_Body-Text _idGenParaOverride-2">In the preamble to the Special Advisory Bulletin (see Appendix H), CMS and the OIG advise that hospitals should be very concerned about patients leaving without being screened, especially if due to waiting times:</p><p class="Body-Styles_Quote-Style _idGenParaOverride-5">Since every patient who presents seeking emergency services is entitled to  a medical screening examination, a hospital could violate the patient anti- dumping statute if it routinely keeps patients waiting so long that they leave without being seen, particularly if the hospital does not attempt to determine and document why individual patients are leaving, and reiterate to them that the hospital is prepared to provide a medical screening if they stay.</p><p class="Body-Styles_Body-Text _idGenParaOverride-2">This advice reinforces the need for hospitals to monitor waiting times for emergency services and the rate of patient departures before the provision of the medical screening examination.</p><p class="Body-Styles_Compliance-Tip _idGenParaOverride-6"><span class="Compliance-Tip">Compliance Tip:</span> Hospitals should develop quality management measures to determine the reasons for patient departures, and implement actions as appropriate to reduce unacceptable rates of patient elopement. In addition, patient registration, reception and other emergency staff should receive periodic in-service reminders of the need to document 1) early patient departures and elopements, and 2) communication to patients offering the medical screening and encouraging patients to stay for their examination. For example, some hospitals have developed information sheets to hand to patients at triage informing them of the medical screening, encouraging patients to remain for their examination by the emergency physician, and urging them to inform the triage nurse or other emergency staff if they decide to leave the dedicated emergency department or other hospital location before they receive their medical screening.</p><p class="Body-Styles_Header-3 _idGenParaOverride-2"><a id="_idTextAnchor008"></a>Patient Elopes or Leaves Without Notice</p><p class="Body-Styles_Body-Text _idGenParaOverride-2">If a patient elopes or leaves the hospital without advising personnel in the dedicated emergency department or other location as to his or her reasons for leaving, the hospital, to the best of its ability, should document the circumstances of the patient’s departure. It is recommended that hospital personnel call the patient’s name in the waiting area several times, and note the times in the medical record. If the patient does not respond, the medical record should include the time when hospital staff became aware of the departure and any other pertinent information related to the patient and his or her medical condition.</p><p class="Body-Styles_Body-Text _idGenParaOverride-2">Some hospitals have initiated patient follow-up call programs where they telephone eloped patients within a few days after their emergency visits to inquire as to the reasons for leaving the hospital and their present medical status. This information has been used effectively by  a hospital in responding to allegations of the quality improvement organization (QIO) that the hospital failed to provide medical screening examinations to a number of patients who allegedly may have had emergency medical conditions (based on triage data). Using the information derived from the follow-up calls, the hospital was able to demonstrate that the patients left the hospital for valid reasons (such as the patient felt better) and were in good health.</p><p class="Body-Styles_Header-3 _idGenParaOverride-2"><a id="_idTextAnchor009"></a>Patient Gives Reason for Leaving</p><p class="Body-Styles_Body-Text _idGenParaOverride-2">If a patient advises the hospital that he or she is leaving prior to the medical screening, the hospital should make every effort to offer the patient the examination, encourage the patient to wait and, if unsuccessful, obtain from the patient the reasons for leaving the hospital. Some hospitals have developed forms for refusal of a medical screening examination. Regardless of whether the patient signs a form, the hospital should document the patient’s reasons for leaving. The documentation should be sufficiently detailed to reply to a subsequent complaint from the patient or a licensing surveyor that the hospital refused or discouraged the patient from receiving a medical screening examination. The <span class="Italic">Interpretive Guidelines</span> state that the medical record should reflect that the hospital offered to provide screening and treatment before the patient’s refusal.</p><p class="Body-Styles_Header-3 _idGenParaOverride-2"><a id="_idTextAnchor010"></a>Patient Departs for Financial Reasons</p><p class="Body-Styles_Body-Text _idGenParaOverride-2">One of the more difficult situations is handling the patient who leaves the hospital before the medical screening examination due to financial reasons. Often, a patient will ask hospital personnel how much his or her emergency services will cost or whether it accepts the patient’s managed care plan, and then leave the hospital without receiving emergency services. CMS has repeatedly cautioned hospitals that discussing payment obligations when a patient is deciding on whether to accept or refuse treatment will be closely scrutinized to determine whether the hospital discouraged the patient from seeking further treatment. CMS has warned that hospitals “may not attempt to coerce individuals into making judgments against their interest by informing them that they will have to pay for their care if they remain but that their care will be free or at lower cost if they transfer to another hospital.”</p><p class="Body-Styles_Compliance-Tip _idGenParaOverride-6"><span class="Compliance-Tip">Compliance Tip:</span> It is recommended that hospitals have clear guidelines for staff to handle these situations, and ensure, through in-service education and policies, that hospitals offer to provide emergency services, encourage the patient to stay and document the circumstances of and reasons for the patient’s decision to decline further care.</p><p class="Body-Styles_Header-3 _idGenParaOverride-2"><a id="_idTextAnchor011"></a><a id="_idIndexMarker004"></a>Documentation of Risks and Benefits</p><p class="Body-Styles_Body-Text _idGenParaOverride-2">Under the EMTALA regulations, a hospital must inform a patient of the risks and benefits of refusing further examination and treatment. The regulation applies this obligation to a refusal of the further examination and treatment rendered after a patient has received a medical screening examination.</p><p class="Body-Styles_Body-Text _idGenParaOverride-2">If the patient withdraws his or her request for a medical screening before the examination has been performed, the hospital may not have sufficient medical information to describe the risks and benefits to the individual if he or she leaves the hospital. This is consistent with a statement by CMS and OIG in the Special Advisory Bulletin that prior to performing the medical screening examination, a hospital is “ill-informed” to advise a health plan of the patient’s condition. The rationale for this position is that prior to receiving a medical screening, the patient has not been examined by a qualified professional who has obtained the requisite clinical knowledge to advise a health plan of the patient’s medical status. If a hospital is “ill-informed” to advise a managed care plan of a patient’s condition, then it should be equally “ill-informed” to advise the patient of the risks and benefits of withdrawing a request for a medical screening examination.</p><p class="Body-Styles_Body-Text _idGenParaOverride-2">However, this interpretation of EMTALA is not necessarily held by CMS and the OIG. A number of hospitals have been cited by these agencies for their failure to inform a patient withdrawing a request for the medical screening of the risks and benefits of leaving the hospital prior to his or her examination. Regardless of what action a hospital takes with respect to a patient who withdraws his or her request for the medical screening prior to the performance of the examination, hospitals should take (and document) every step taken to offer and encourage the patient to remain for his or her medical screening examination.</p><p class="Body-Styles_Reference-Header _idGenParaOverride-2"><span class="Reference-mark">F</span>&#9;References:</p><p class="Body-Styles_References _idGenParaOverride-7">42 C.F.R. Section 489.24(c)(2) and (4) (Appendix B)</p><p class="Body-Styles_References _idGenParaOverride-7"><span class="Italic">Interpretive Guidelines</span>, tag nos. A-240<span class="No-break">7/C</span>-2407 and A-240<span class="No-break">9/C</span>-2409 (Appendix C) </p><p class="Body-Styles_References _idGenParaOverride-7">Health and Safety Code Section 1317.3(d) (Appendix D)</p><p class="Body-Styles_References _idGenParaOverride-7">Special Advisory Bulletin (Appendix H)</p></li>
				<li class="Body-Styles_Header-2"><a id="_idTextAnchor012"></a>Is a hospital liable for a potential EMTALA violation if a patient leaves the hospital after receiving a medical screening?<p class="Body-Styles_Body-Text _idGenParaOverride-2">As discussed in this chapter, patients (and their representatives) have the right to refuse stabilizing treatment or other emergency services. If the patient has received a medical screening that reveals the presence of an emergency medical condition (EMC), the hospital is obligated to obtain an informed refusal if the patient refuses further examination and treatment that may stabilize the EMC.</p><p class="Body-Styles_Body-Text _idGenParaOverride-2">In the <span class="Italic">Interpretive Guidelines</span>, CMS specifies the circumstances that will not constitute an EMTALA violation when a patient leaves the hospital after the medical screening examination identifies the presence of an EMC without receiving further evaluation or stabilizing treatment:</p><p class="Body-Styles_Body-Text _idGenParaOverride-2">If a screening examination reveals an EMC and the individual is told to wait for treatment but the individual leaves the hospital, the hospital did not violate EMTALA unless one of the following situations applies to the departure:</p><ol><li class="Body-Styles_Numbered-List _idGenParaOverride-3">The individual left the emergency department based on a “suggestion” by the hospital; or</li><li class="Body-Styles_Numbered-List _idGenParaOverride-3">The individual’s condition was an emergency, but the hospital was operating beyond its capacity and did not attempt to transfer the individual to another facility. </li></ol></li>
			</ol>
			<p class="Body-Styles_Body-Text">However, if an individual leaves a hospital Against Medical Advice (AMA) or Left Without Being Seen (LWBS), on his or her own free will (no coercion or suggestion by the hospital), the hospital is not in violation of EMTALA.</p>
			<p class="Body-Styles_Reference-Header"><span class="Reference-mark">F</span>&#9;References:</p>
			<p class="Body-Styles_References">42 C.F.R. Section 489.24(c)(2) and (4) (Appendix B)</p>
			<p class="Body-Styles_References"><span class="Italic">Interpretive Guidelines</span>, tag nos. A-240<span class="No-break">6/C</span>-2406, A-240<span class="No-break">7/C</span>-2407 and A-240<span class="No-break">9/C</span>-2409 (Appendix C)</p>
			<p class="Body-Styles_Body-Text"> </p>
		</div>
	








		<!-- searchable content -->
		<div id="search-content"></div>










		<div id="search-modal">
			<div class="modal-btn-container">
				<button id="close-modal">&times;</button>
			</div>
			<div style="text-align: center;">
				<div class="group">      
					<input type="text" required id="search-input">
					<span class="highlight"></span>
					<span class="bar"></span>
					<label>Search</label>
			    </div>
			</div>
			<ul id="search-results"></ul>
		</div>


		<footer id="menu-bar-footer" class="triggered">
			<div>
				<!-- <a href="tp-previous-article://show">
					<div class="chev a-prev"></div>
					<span>Previous</span>
				</a> -->
				<div>
					<div class="alert alert-primary alert-bottom alert-dismissable">
						<strong>Previous Button</strong> Tap this to go back to the previous position in the same chapter
						<button type="button" class="close" data-dismiss="alert" aria-label="Close">
			    			<span aria-hidden="true" style="font-size:24px !important;">&times;</span>
			  			</button>
					</div>
					<a href="#" id="a-back" class="disabled">
						<div>
							<svg class="icon" height="512" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M785.5961 258.6122c-118.9094-118.8885-293.3447-147.6859-438.3138-86.5384l-35.84-61.2101c-8.5473-14.6077-18.5156-20.062-34.9623-24.0953-17.1781-4.2423-36.2789 9.1115-44.6589 23.6147l-99.8504 202.5848c-8.3592 14.5032-10.5326 32.3291-1.9853 46.9368s25.2865 21.6712 42.2139 21.7548L383.7701 369.8939c16.9273 0.1045 31.2842-8.0875 39.6434-22.5698 8.3801-14.5032 8.2756-31.0335-0.2717-45.662l-32.7889-56.0274c112.4101-43.0707 244.9241-19.1425 336.1228 72.0562 123.4024 123.4024 124.1966 322.6854 1.7972 445.1056s-321.7032 121.6261-445.1056-1.7972c-29.4661-29.4661-51.7433-63.3208-67.2078-99.3698 0 0 2.4869-24.4715-22.4026-49.3401-16.4467-16.4467-43.0289-16.5512-59.3502-0.2299-27.857 27.8361-4.5976 57.8873-4.5976 57.8873 19.3933 54.7318 50.5731 106.3079 94.4588 150.1936 156.2958 156.2958 408.7432 157.3198 563.806 2.257S941.9128 414.9081 785.5961 258.6122z" /></svg>
						</div>
						<span>Return</span>
					</a>
				</div>
				<a href="tp-article-top://show">
					<div class="chev a-top"></div>
					<span>Top</span>
				</a>
				<a href="#" id="search-button">
					<div class="a-search">
						<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" class="icon" viewBox="0 0 20 20"><path d="M18.64 17.02l-5.31-5.31c.81-1.08 1.26-2.43 1.26-3.87C14.5 4.06 11.44 1 7.75 1S1 4.06 1 7.75s3.06 6.75 6.75 6.75c1.44 0 2.79-.45 3.87-1.26l5.31 5.31c.45.45 1.26.54 1.71.09.45-.36.45-1.17 0-1.62zM3.25 7.75c0-2.52 1.98-4.5 4.5-4.5s4.5 1.98 4.5 4.5-1.98 4.5-4.5 4.5-4.5-1.98-4.5-4.5z"></path></svg>
					</div>
					<span>Search</span>
				</a>
				<a href="tp-next-article://show">
					<div class="chev a-next"></div>
					<span>Next</span>
				</a>
			</div>
		</footer>

		<div class="alert alert-primary alert-top alert-dismissable">
			<strong>Back Button</strong> Tap this to go back to the previous chapter
			<button type="button" class="close" data-dismiss="alert" aria-label="Close">
    			<span aria-hidden="true">&times;</span>
  			</button>
		</div>

		<script>



			/**
			 *	function to conver html collection to array
			 */
			function colToArr( col ){
				var elems = []
				for( var i = 0; i < col.length; i++ )
					elems.push( col[i] )
				return elems;
			}




			/**
			 *	Search Modal
			 *
			 * 	- toggle the search modal
			 */
			function showSearchModal(e){

				var fromTop = window.pageYOffset;

				document.body.style.overflow = 'hidden';

				document.getElementById('search-modal').style.display = 'block'

				// clear the old highlights
				for(var i = 0; i < highElems.length; i++)
					highElems[i].className = ''


				setTimeout(function(){

					window.scrollTo(0, fromTop)

					document.getElementById('search-modal').style.opacity = '1'

				}, 20);
			}

			document.getElementById('search-button')
				.addEventListener('click', showSearchModal, false);

			function hideSearchModal(){

				document.getElementById('search-modal').style.opacity = '0'

				setTimeout(function(){

					document.body.style.overflow = 'initial';

					document.getElementById('search-modal').style.display = 'none'

					// clear the search content
					results.innerHTML = ''

					// clear the input
					searchInput.value = ''

				}, 300);
			}

			document.getElementById('close-modal')
				.addEventListener('click', hideSearchModal, false);



			/**
			 *	Search Content
			 *
			 * 	- 
			 */

			// cross ref str pieces
			var str1 = 'tp-collection://emergency%20medical%20treatment%20manual/Chap'
			var str2 = '-EMTALA2020'

			// search subject
			// var searchContent = document.getElementById('search-content')

			// search input
			var searchInput = document.getElementById('search-input')

			// results list
			var results = document.getElementById('search-results')

			// array of all the list items
			var lis = []

			// the current search term
			var searchTerm = ''

			var chap;






			/**
			 *	find child nodes
			 *
			 */

			// the objects

			function dfsTreeToList(elem, arr, lastID){

				// loop through all the children
				for( var i = 0; i < elem.childNodes.length; i++ ){

					// if this is a text node
					if(elem.childNodes[i].nodeType === 3){

						// arr.push(elem.childNodes[i].nodeValue)
						if(arr.hasOwnProperty(lastID)){
							arr[lastID] = arr[lastID] + elem.childNodes[i].nodeValue
						}else{
							arr[lastID] = elem.childNodes[i].nodeValue
						}

					}
					// else 
					if(  elem.childNodes[i].nodeType == 1  && elem.childNodes[i].hasAttribute('id') && elem.childNodes[i].id.indexOf('_idTextAnchor') > -1 ){ 

						lastID = elem.childNodes[i].id
					}
					// call the function again with the child node
					dfsTreeToList( elem.childNodes[i], arr, lastID  )
				}
				return arr;
			}

			scElem = document.getElementById('search-content')

			searchContent = {}

			// loop through all the chapters
			for(var i = 0; i < scElem.children.length; i++){

				searchContent[scElem.children[i].dataset.chapter] = dfsTreeToList(scElem.children[i], {}, '')

			}




			/**
			 *	search link section
			 *
			 *  - set the localStorage anchor
			 *  - navigate to the page
			 */

			var navId = ''

			function searchLink(e){ e.preventDefault()

				// if the link is in the current chapter
				if( currChap == this.dataset.href ){

					// set the nav id
					navId = this.dataset.anchor

					// set a timeout to scroll to view
					setTimeout(function(){

						prevLocs.push( window.pageYOffset )

						// go directly the section
						document.getElementById(navId).scrollIntoView();

						// then scroll to center and highlight
						highlightText( document.getElementById(navId), searchTerm )

					}, 350)

					// close the search modal
					hideSearchModal();

					return;
				}

				// set localStorage
				localStorage.setItem('anchor', this.dataset.anchor)
				localStorage.setItem('searchterm', searchTerm)

				// navigate to the link
				window.location.href = this.href
			}

			var myInter;


			function findShit(){

				// set the global searchTerm variable
				searchTerm = this.value

				var	filter = this.value.toUpperCase()

				clearInterval(myInter)

				// clear the results
				results.innerHTML = ''

				// if the value is empty, do nothing
				if( this.value.length == 0 ) return;

				myInter = setInterval(function(){
				
					helperLoop2(filter, searchContent)

				}, 400)
			}

			function helperLoop2(filter, searchContent){

				var indexOfVal = -1
				var txtValue = ''

				// loop through the chapters
				for(var x in searchContent){

					// loop through the sections
					for( var y in searchContent[x] ){

						// get the index of the matching text
						indexOfVal = searchContent[x][y].toUpperCase().indexOf( filter )

						if( indexOfVal > -1 ){

							txtValue = searchContent[x][y].slice( indexOfVal, indexOfVal + 200 )

							createResultsElem2( x, y, txtValue )

						}
					}
				}

				clearInterval(myInter)
			}

			/**
			 *	create new result element
			 *
			 */
			function createResultsElem2( chap, anchor, txtValue ){

				if(!anchor) return;

				var resultElem = document.createElement('li')
				resultElem.innerHTML = 
					'<a href="'+ str1 + addLeading0(chap) + str2 +'" data-href="'+addLeading0(chap)+'" data-anchor="'+anchor+'">' + 
						'<span class="result-ch">Ch ' + chap + '</span>' +
						'<div class="result-text">' + txtValue + '</div>' +
					'</a>'
				// add the event listener
				resultElem.children[0].addEventListener('click', searchLink, false)
				results.appendChild( resultElem )
			}

			/**
			 *	- find the text in the section
			 *	- highlight it
			 *
			 *	@ anchorElem - the <a> tag with the id
			 *  @ searchTerm - str
			 */


			function textNodesUnder(node){
			  var all = [];
			  for (node=node.firstChild;node;node=node.nextSibling){
			    if (node.nodeType==3) all.push(node);
			    else all = all.concat(textNodesUnder(node));
			  }
			  return all;
			}

			// keep a list of all the highlight elements
			var highElems = []

			function highlightText( anchorElem, searchTerm ){

				var section;

				// clear the high elems
				highElems = []			

				// if the anchor elem is a header 1, do nothing
				if( anchorElem.parentElement.className == 'Body-Styles_Header-1' ){
					
					// loop through the children
					var cNodes = anchorElem.parentElement.childNodes
					for( var i = 0; i < cNodes.length; i++ ){

						// if the node is not an ol
						if( cNodes[i].nodeType == 1 && cNodes[i].tagName == 'OL' ) continue;

						var cni = textNodesUnder( cNodes[i] )

						// get the nodes for each of these children if they are not OL tags
						if( cni.length )
							highlightHelper( cni )
					}

					return;
				}
				
				// get the section
				section = anchorElem.parentElement.tagName == 'LI' ?
							anchorElem.parentElement :
							anchorElem.parentElement.parentElement ;

				// highlight the child nodes
				highlightHelper( textNodesUnder( section ) );
			}

			/**
			 *	highlight the elmes
			 *
			 */
			function highlightHelper( nodes ){

				// loop through the child nodes
				for( var i = 0; i < nodes.length; i++ ){

					var nVal = nodes[i].nodeValue

					// find the position of the search term
					var j = nVal.toUpperCase().indexOf( searchTerm.toUpperCase() )

					// if the term is found
					if( j > -1 ){

						// create the first text node
						var tn1 = document.createTextNode( nVal.substr(0, j) );

						// create the second text node
						var tn2 = document.createTextNode( nVal.substr( j +searchTerm.length ) )

						// create the highlight span
						var hSpan = document.createElement('span')
						hSpan.className = 'highlighter'
						hSpan.innerHTML = nVal.substr(j, searchTerm.length)
						// push it onto the array
						highElems.push( hSpan )


						// append all the children
						nodes[i].parentElement.insertBefore( tn1, nodes[i] )
						nodes[i].parentElement.insertBefore( hSpan, nodes[i] )
						nodes[i].parentElement.insertBefore( tn2, nodes[i] )
						nodes[i].parentElement.removeChild( nodes[i] )
					}
				}

				if( highElems.length )
					scrollToText( highElems[0] )
			}



			/**
			 * - scroll to highlighted text
			 *
			 */
			function scrollToText( elem ){

				// if the highlight is greater than 25% down the page
				var distanceFromTop = elem.getBoundingClientRect().top
				if( distanceFromTop / window.innerHeight > .25 || distanceFromTop / window.innerHeight < 0){

					// get the distance to 25%
					var scrollPos = distanceFromTop - (window.innerHeight * .25)
					scrollPos = window.scrollY + scrollPos
					setTimeout(function(){
						window.scrollTo({
							top: scrollPos,
							behavior: 'smooth'
						})
					}, 50)
				}
			}

			searchInput.addEventListener('keyup', findShit, false)







			/**
			 *	fix the cross ref links
			 */

			// function to add a leading 0 to single digit numbers
			function addLeading0( int ){
				if( 0 < int && int < 10 )
					return '0' + int;
				return int;
			}

			// function to add the alert in localStorage
			function storeSectionTitle(e){ e.preventDefault()

				localStorage.setItem('xref', this.dataset.title )

				window.location.href = this.href
			}

			// get the next button
			var nextButton = document.querySelector('.a-next').parentElement

			// get the current chapter
			var currChap = parseInt( document.querySelectorAll('.Chapter-number')[1].innerHTML )

			// wrapping this in a function to for more async loading
			function fixCrossRef(){

				if( currChap == '20' ){
					// remove the next button
					nextButton.parentElement.removeChild( nextButton )
				}else{
					nextButton.href = str1 + addLeading0( currChap + 1 ) + str2
				}

				// loop through all the blank hrefs
				var crossRefs = document.getElementById('_idContainer003').querySelectorAll('[href=""]');
				for( var i = 0; i < crossRefs.length; i++ ){

					// if this is a legit cross ref link
					if( crossRefs[i].children.length > 1 ){

						// remove the page number but keep the chapter
						var myItalic = crossRefs[i].querySelectorAll('.Italic');
						myItalic = myItalic[ myItalic.length - 1 ]
						// console.log(myItalic)
						var chap = myItalic.innerHTML = myItalic.innerHTML.split('.')[0]

						// get the inner HTML
						var title = crossRefs[i].innerHTML

						// get everything after the first quote and before the comma
						title = title.split('"')[1]
						title = title.split(',')[0]; console.log(title)
						crossRefs[i].setAttribute('data-title', title)

						// get the chapter
						// var chap = crossRefs[i].children[ crossRefs[i].children.length - 1 ].innerHTML
						// chap = chap.split('.')[0]

						// // set the href
						crossRefs[i].href = str1 + addLeading0( chap ) + str2

						// replace "page" with chapter
						crossRefs[i].innerHTML = crossRefs[i].innerHTML.replace('page&nbsp;', 'Chapter&nbsp;')

						// remove the page number
						// title = crossRefs[i].innerHTML; console.log(title);
						// title = title.split(',"')[0]
						// title = title + '"</span>'
						// crossRefs[i].innerHTML = title

						// // add the event listener
						crossRefs[i].addEventListener('click', storeSectionTitle, false)
					}
				}
			}

			/**
			 *	display the cross reference on page load
			 *
			 */
			function displayCrossRef(){

				// get the cross reference
				var crossRef = localStorage.getItem('xref')

				// if we were NOT refered to this page by a cross reference
				if( crossRef == null ) return; //do nothing

				// get all the table of contents
				var tocs = document.getElementById('_idContainer001')
							.querySelectorAll('a')

				// loop through those bitches
				for( var i = 0; i < tocs.length; i++ ){

					// if the toc entry contains the title text
					if( tocs[i].innerHTML.indexOf( crossRef ) > -1 ){

						// console.log(document.getElementById( tocs[i].dataset.href ))

						var myId = tocs[i].dataset.href

						setTimeout(function(){

							document.getElementById( myId ).scrollIntoView()

						}, 100)

						break;
					}
				}

				localStorage.removeItem('xref')
			}










			/**
			 *	window scroll
			 *
			 * 	- keep track of the current location on the page
			 */
			window.currLoc = 0 
			window.prevLocs = []
			window.nextLocs = []

			function getCurrLoc(){

				this.currLoc = window.pageYOffset;
			}

			window.addEventListener('scroll', getCurrLoc, false)

			/**
			 *	- highjack all the anchor tags
			 *
			 */
			function setLocs(e){ e.preventDefault()

				// remove the scroll event listener
				window.removeEventListener('scroll', getCurrLoc, false)

				// if the current scroll position has not already been added to the prevLocs array
				// if( window.currLoc != -1 ){

				// 	// add it
				// 	prevLocs.push( window.currLoc )

				// 	// set it to -1
				// 	window.urrLoc = -1
				
				// }else{

					// add this current position to the array
				prevLocs.push( window.pageYOffset )
				// }

				// clear the nextLocs 
				// nextLocs = []

				// enable the back button
				backBtn.className = ''

				// disable the forward button
				// forwardBtn.className = 'disabled'

				// go to that anchor
				document.getElementById( this.dataset.href ).scrollIntoView()
			}

			var aTags = document.getElementById('_idContainer001').getElementsByTagName('A')

			// loop through the tags
			for( var i = 0; i < aTags.length; i++ ){

				// if the a tag is an anchor
				if( aTags[i].href.indexOf('#') > -1 ){

					aTags[i].setAttribute('data-href', aTags[i].href.split('#')[1] )

					// add the set Loc event listener
					aTags[i].addEventListener('click', setLocs, false)
				}
			}

			var aTags = document.getElementById('_idContainer003').getElementsByTagName('A')
			// console.log(aTags)

			// loop through the tags
			for( var i = 0; i < aTags.length; i++ ){

				// if the a tag is an anchor
				if( aTags[i].href.indexOf('#') > -1 ){

					aTags[i].setAttribute('data-href', aTags[i].href.split('#')[1] )

					// remove the page number
					// aTags[i].innerHTML = aTags[i].innerHTML.split(',"')[0] + '"</span>'

					// get the last Italic class span and remove the page number
					var lastSpan = aTags[i].querySelectorAll('.Italic')
					if(lastSpan.length){
						lastSpan = lastSpan[ lastSpan.length - 1 ]
						lastSpan.innerHTML = lastSpan.innerHTML.split('.')[0]
					}

					// change page to chapter
					aTags[i].innerHTML = aTags[i].innerHTML.split('page')[0] + '</span>'

					aTags[i].innerHTML = aTags[i].innerHTML.replace(',"', '"')

					// add the set Loc event listener
					aTags[i].addEventListener('click', setLocs, false)
				}
			}



			/**
			 *	back button
			 *
			 */
			var backBtn = document.getElementById('a-back')

			backBtn.addEventListener('click', function(e){ e.preventDefault()

				var loc = prevLocs.pop()

				window.scrollTo( 0, loc )

				// push it to the forward array
				nextLocs.push( loc )

				// enable the forward button
				// forwardBtn.className = ''

				// maybe disable the back button
				if( !prevLocs.length ){

					backBtn.className = 'disabled'
				}

			}, false)










			/**
			 *	sticky footer nav
			 */
			window.lastScrollTop = 0;
			window.trigFoot = document.getElementById('menu-bar-footer')
			// element should be replaced with the actual target element on which you have applied scroll, use window in case of no target element.
			window.addEventListener("scroll", function(){ // or window.addEventListener("scroll"....
			   var st = this.pageYOffset || document.documentElement.scrollTop; // Credits: "https://github.com/qeremy/so/blob/master/so.dom.js#L426"
			   if (st > this.lastScrollTop){
			      this.trigFoot.className = ''
			   } else {
			      this.trigFoot.className = 'triggered'
			   }
			   this.lastScrollTop = st <= 0 ? 0 : st; // For Mobile or negative scrolling
			}, false);








			/**
			 *	UI helper
			 *
			 */
			var alertTop = document.querySelector('.alert-top')
			var alertBottom = document.querySelector('.alert-bottom')

			// add the close event listener
			alertTop.querySelector('.close').addEventListener('click', function(){
				displayUI(alertBottom)
				var par = this.parentElement
				par.style.opacity = '0'
				setTimeout(function(){
					par.parentElement.removeChild(par)
				}, 250)
			}, false)

			alertBottom.querySelector('.close').addEventListener('click', function(){
				var par = this.parentElement
				par.style.opacity = '0'
				setTimeout(function(){
					par.parentElement.removeChild(par)
				}, 250)
			}, false)

			function uiHelper(){

				// if the trigger is already triggered, do nothing
				if( localStorage.getItem('uihelper') ) return;

				// set the trigger
				localStorage.setItem('uihelper', true)

				// display the first element
				displayUI( alertTop )

			}

			function displayUI( elem ){

				elem.style.display = 'block'

				var elem = elem

				setTimeout(function(){
					elem.style.opacity = '1'
				}, 50)
			}










			/**
			 * get the external links
			 *
			 */
			var xternalRefs = document.getElementById('_idContainer003')
								.querySelectorAll('a')

			// loop through those bitches
			for(var i = 0; i < xternalRefs.length; i++){

				// if this is an external link
				if( xternalRefs[i].href.indexOf('http') > -1 ){

					xternalRefs[i].setAttribute('target', '_system')
				}
			}








			
			/**
			 *	get the last ordered list of a root level elem
			 *
			 *	used primarily on the prev variable
			 */
			function getLastOl( masterList ){

				// get the last L1
				var lastElem = masterList.children[ masterList.children.length - 1]

				// get the last child of the last L1
				lastElem = lastElem.children[ lastElem.children.length - 1 ]

				// if the last child is an OL with h2 elems
				if( lastElem.tagName == 'OL' && lastElem.children[0] !== 'undefined' && lastElem.children[0].className.indexOf('Body-Styles_Header-2') > -1 ){

					// return level 2 list
					return lastElem;

				}

				// else return the masterList
				return masterList;
			}



			/**
			 *	navigate to the anchor
			 */
			function navToAnchor(){ 

				if( localStorage.getItem('anchor') == null ) return;

				setTimeout(function(){

					// navigate to the section
					document.getElementById( localStorage.getItem('anchor') ).scrollIntoView()

					// if there is a search term
					if( localStorage.getItem( 'searchterm' ) ){
						searchTerm = localStorage.getItem( 'searchterm' )
						highlightText( document.getElementById( localStorage.getItem('anchor') ), searchTerm )

						localStorage.removeItem('searchterm')
					}

					// clear the localStorage
					localStorage.removeItem('anchor')


				}, 50)
			}

			/**
			 *	tag patrol
			 */
			function tagPatrol( elems ){

				// master list
				var masterList = elems.shift()

				if( masterList.tagName != 'OL' ){
					tagPatrol( elems )
					return;
				}

				// loop through all the elems
				while( elems.length ){

					var curr = elems.shift()

					var lastOl = getLastOl( masterList )

					// if curr is an h1 list
					if( curr.tagName == 'OL' && curr.children[0].className.indexOf('Body-Styles_Header-1') > -1){

						// loop through the children
						while( curr.children.length ){

							// append them to the master list
							masterList.appendChild( curr.children[0] )
						}
					}

					// if curr is an h2 list
					else if( curr.tagName == 'OL' && curr.children[0].className.indexOf('Body-Styles_Header-2') > -1  ){

						// if the last OL is a L1
						if( lastOl === masterList ){

							// append the whole list to the last list item
							masterList.children[ masterList.children.length - 1 ].appendChild( curr )
						}

						// else if the last OL is l2
						else{

							// loop through the curr list
							while( curr.children.length ){

								// append them to the last ol
								lastOl.appendChild( curr.children[0] )
							}
						}
					}

					// if this is any other element, append it to the last li of the last ol
					else{

						lastOl.children[ lastOl.children.length - 1 ].appendChild( curr )
					}
				}

				// navigate to the proper section if requested
				navToAnchor();
			}

			/**
			 *	initalize
			 */
			document.addEventListener('DOMContentLoaded', function(){ 
				
				tagPatrol(
					colToArr(
						document.getElementById('_idContainer003').children
					)
				)

				// navToAnchor();

				fixCrossRef()

				setTimeout(function(){ displayCrossRef(); }, 1000);

				// display the UI helper
				uiHelper();

			}, false);
		</script>
	</body>
</html>		




